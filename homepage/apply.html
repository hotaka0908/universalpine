<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>応募フォーム - Universal Pine</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="images/logohead.svg" alt="Universal Pine" class="logo-image">
                </a>
            </div>
            
            <div class="menu-toggle">
                ☰
            </div>

            <nav>
                <ul>
                    <li class="dropdown">
                        <a href="news.html">ニュース</a>
                        <div class="dropdown-content">
                            <a href="news.html#announcements">お知らせ</a>
                            <a href="news.html#press">プレスリリース</a>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a href="product.html">製品</a>
                        <div class="dropdown-content">
                            <a href="product.html">AIネックレス</a>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a href="recruit.html">採用</a>
                        <div class="dropdown-content">
                            <a href="recruit.html#hardware-engineer">ハードウェアエンジニア</a>
                            <a href="recruit.html#software-engineer">ソフトウェアエンジニア</a>
                        </div>
                    </li>
                    <li class="dropdown">
                        <a href="about.html">会社情報</a>
                        <div class="dropdown-content">
                            <a href="about.html#ceo-message">代表メッセージ</a>
                            <a href="about.html#philosophy">理念</a>
                            <a href="about.html#history">沿革</a>
                            <a href="about.html#about">会社概要</a>
                        </div>
                    </li>
                    <li>
                        <a href="contact.html">お問い合わせ</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="apply-section">
        <div class="container">
            <h2 class="section-title">応募フォーム</h2>
            <!-- 説明文を削除 -->
            
            <form id="apply-form" class="apply-form" method="post" enctype="multipart/form-data" autocomplete="on">
                <!-- CSRF Protection Token -->
                <input type="hidden" name="csrf_token" id="csrf_token" value="">
                <div class="form-group">
                    <label for="name">お名前 <span class="required">*</span></label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">メールアドレス <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">電話番号 <span class="required">*</span></label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label for="postal_code">郵便番号 <span class="required">*</span></label>
                    <input type="text" id="postal_code" name="postal_code" placeholder="例) 123-4567" required>
                </div>
                
                <div class="form-group">
                    <label for="address_line1">住所 <span class="required">*</span></label>
                    <input type="text" id="address_line1" name="address_line1" placeholder="例) 東京都世田谷区池尻1-5-27" required>
                </div>
                
                <div class="form-group">
                    <label for="address_line2"></label>
                    <input type="text" id="address_line2" name="address_line2" placeholder="例) 世田谷マンション101号室">
                </div>
                
                <div class="form-group">
                    <label for="position">応募職種 <span class="required">*</span></label>
                    <select id="position" name="position" required>
                        <option value="">選択してください</option>
                        <option value="electronics-engineer">エレクトロニクスエンジニア</option>
                        <option value="ai-engineer">AIエンジニア</option>
                        <option value="mechanical-engineer">メカニカルエンジニア</option>
                        <option value="embedded-engineer">組み込みエンジニア</option>
                        <option value="mobile-app-engineer">モバイルアプリエンジニア</option>
                        <option value="open-entry">オープンエントリー</option>
                        <option value="part-time">アルバイト</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="resume">履歴書 <span class="required">*</span></label>
                    <input type="file" id="resume" name="resume" required>
                    <p class="form-note">PDFまたはWord形式でアップロードしてください。</p>
                </div>
                
                <div class="form-group">
                    <label for="portfolio">職務経歴書 <span class="required">*</span></label>
                    <input type="file" id="portfolio" name="portfolio" required>
                    <p class="form-note">PDFまたはWord形式でアップロードしてください。</p>
                </div>
                
                <div class="form-group">
                    <label for="message">応募先へのメッセージ</label>
                    <textarea id="message" name="message" rows="5" placeholder="※AIを80%活用し、300字程度でご入力ください。"></textarea>
                </div>
                
                <div class="form-group checkbox-group">
                    <div class="privacy-check-container">
                        <input type="checkbox" id="privacy" name="privacy" required>
                        <label for="privacy">プライバシーポリシーに同意する <span class="required">*</span></label>
                    </div>
                    <div class="privacy-policy-link"><a href="privacy-policy.html">当社プライバシーポリシー</a></div>
                    <div id="privacy-error" class="error-message"></div>
                </div>
                
                <button type="submit" class="submit-button">応募する</button>
                <div id="form-status" class="form-status"></div>
            </form>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>Universal Pine</h2>
                </div>
                
                <div class="footer-nav">
                    <ul>
                        <li><a href="news.html">ニュース</a></li>
                        <li><a href="about.html">会社情報</a></li>
                        <li><a href="recruit.html">採用情報</a></li>
                        <li><a href="contact.html">お問い合わせ</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2025 Universal Pine. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('apply-form');
            const formStatus = document.getElementById('form-status');
            const privacyError = document.getElementById('privacy-error');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // プライバシーポリシーのチェック
                const privacyChecked = document.getElementById('privacy').checked;
                if (!privacyChecked) {
                    privacyError.textContent = 'プライバシーポリシーに同意してください';
                    return;
                } else {
                    privacyError.textContent = '';
                }
                
                // 送信ボタンを無効化
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = '送信中...';
                
                // フォームデータの準備
                const formData = new FormData(form);
                
                try {
                    // ファイルの処理
                    const resumeFile = document.getElementById('resume').files[0];
                    const portfolioFile = document.getElementById('portfolio').files[0];
                    
                    // FormDataオブジェクトからJSONに変換するためのオブジェクトを作成
                    const formDataObj = {};
                    formData.forEach((value, key) => {
                        // ファイル以外のフィールドを追加
                        if (key !== 'resume' && key !== 'portfolio') {
                            formDataObj[key] = value;
                        }
                    });
                    
                    // ファイルをBase64エンコードして追加（実際の実装ではファイルサイズに注意）
                    if (resumeFile) {
                        const resumeBase64 = await fileToBase64(resumeFile);
                        formDataObj.resume = {
                            name: resumeFile.name,
                            type: resumeFile.type,
                            data: resumeBase64
                        };
                    }
                    
                    if (portfolioFile) {
                        const portfolioBase64 = await fileToBase64(portfolioFile);
                        formDataObj.portfolio = {
                            name: portfolioFile.name,
                            type: portfolioFile.type,
                            data: portfolioBase64
                        };
                    }
                    
                    // APIエンドポイントにデータを送信
                    const response = await fetch('/api/submit-application', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formDataObj)
                    });
                    
                    const result = await response.json();
                    
                    if (response.ok) {
                        // 成功時の処理
                        formStatus.textContent = '応募が正常に送信されました。ありがとうございます！';
                        formStatus.className = 'form-status success';
                        form.reset();
                    } else {
                        // エラー時の処理
                        formStatus.textContent = `エラー: ${result.error || '応募の送信中に問題が発生しました。'}`;
                        formStatus.className = 'form-status error';
                    }
                } catch (error) {
                    console.error('応募フォーム送信エラー:', error);
                    formStatus.textContent = 'エラー: 応募の送信中に問題が発生しました。後でもう一度お試しください。';
                    formStatus.className = 'form-status error';
                } finally {
                    // 送信ボタンを再有効化
                    submitButton.disabled = false;
                    submitButton.textContent = '応募する';
                }
            });
            
            // ファイルをBase64に変換する関数
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => {
                        // data:image/jpeg;base64, などのプレフィックスを削除
                        const base64 = reader.result.split(',')[1];
                        resolve(base64);
                    };
                    reader.onerror = error => reject(error);
                });
            }
        });
    </script>
    <script src="js/mobile-menu.js"></script>
</body>
</html>
