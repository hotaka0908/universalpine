name: Security Fix

on:
  schedule:
    - cron: '0 1 1 * *' # æ¯æœˆ1æ—¥ã®åˆå‰1æ™‚ã«å®Ÿè¡Œï¼ˆDependabotã¨ã®é‡è¤‡ã‚’é¿ã‘ã‚‹ãŸã‚ï¼‰
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  security-fix:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run security audit fix
        run: npm audit fix

      - name: Check if there are changes
        id: git-check
        run: |
          git diff --exit-code || echo "changes=true" >> $GITHUB_OUTPUT

      - name: Create Pull Request
        if: steps.git-check.outputs.changes == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'fix: npm audit automatic fix'
          title: 'ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£: npm audit fix ã®è‡ªå‹•é©ç”¨'
          body: |
            ã“ã®PRã¯ã€npm audit fixã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚
            
            ## å¤‰æ›´å†…å®¹
            - ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è„†å¼±æ€§ã‚’ä¿®æ­£
            
            ## ç¢ºèªäº‹é …
            - [ ] ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„
          branch: security/npm-audit-fix
          base: main
          labels: |
            security
            dependencies
            automated-pr
